<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—Ç–ø—É—Å–∫–Ω—ã—Ö</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { 
            padding: 40px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card { 
            max-width: 600px; 
            margin: auto;
            border-radius: 15px;
            overflow: hidden;
        }
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            border: none;
            padding: 20px;
        }
        .card-body {
            padding: 30px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px;
            font-weight: 600;
            transition: transform 0.2s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }
        .alert-success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .alert-danger {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
<div class="card shadow-lg">
    <div class="card-header bg-primary text-white">
        <h3 class="mb-0">üí∞ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—Ç–ø—É—Å–∫–Ω—ã—Ö</h3>
        <small>–†–∞—Å—á—ë—Ç –ø–æ —Ä–æ—Å—Å–∏–π—Å–∫–æ–º—É —Ç—Ä—É–¥–æ–≤–æ–º—É –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É</small>
    </div>
    <div class="card-body">
        <form id="calcForm">
            <div class="mb-3">
                <label class="form-label fw-bold">–°—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –∑–∞ 12 –º–µ—Å—è—Ü–µ–≤ (—Ä—É–±.)</label>
                <input type="number" class="form-control" id="salary" required min="0.01" step="0.01" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É">
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">–í–∞—Ä–∏–∞–Ω—Ç —Ä–∞—Å—á—ë—Ç–∞</label><br>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="mode" id="modeDays" value="days" checked>
                    <label class="form-check-label" for="modeDays">–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–Ω–µ–π</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="mode" id="modeDates" value="dates">
                    <label class="form-check-label" for="modeDates">–ü–æ –¥–∞—Ç–∞–º –æ—Ç–ø—É—Å–∫–∞</label>
                </div>
            </div>

            <div id="daysBlock">
                <div class="mb-3">
                    <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –æ—Ç–ø—É—Å–∫–∞</label>
                    <input type="number" class="form-control" id="vacationDays" min="1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 28">
                </div>
            </div>

            <div id="datesBlock" style="display: none;">
                <div class="mb-3">
                    <label class="form-label">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –æ—Ç–ø—É—Å–∫–∞</label>
                    <input type="date" class="form-control" id="startDate">
                </div>
                <div class="mb-3">
                    <label class="form-label">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ—Ç–ø—É—Å–∫–∞</label>
                    <input type="date" class="form-control" id="endDate">
                </div>
            </div>

            <button type="submit" class="btn btn-primary w-100">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
        </form>

        <div id="result" class="mt-4" style="display: none;">
            <div class="alert alert-success">
                <h5 class="mb-3">‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á—ë—Ç–∞:</h5>
                <p class="mb-2"><strong>–°—É–º–º–∞ –æ—Ç–ø—É—Å–∫–Ω—ã—Ö:</strong> <span id="payAmount" class="fs-5 text-primary"></span> —Ä—É–±.</p>
                <p class="mb-2"><strong>–û–ø–ª–∞—á–∏–≤–∞–µ–º—ã—Ö –¥–Ω–µ–π:</strong> <span id="payDays" class="fw-bold"></span></p>
                <p class="mb-0"><strong>–î–µ—Ç–∞–ª–∏:</strong> <span id="details"></span></p>
            </div>
        </div>

        <div id="error" class="mt-4" style="display: none;">
            <div class="alert alert-danger" id="errorMessage"></div>
        </div>
    </div>
</div>

<script>
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤
    document.querySelectorAll('input[name="mode"]').forEach(radio => {
        radio.addEventListener('change', () => {
            document.getElementById('daysBlock').style.display = radio.value === 'days' ? 'block' : 'none';
            document.getElementById('datesBlock').style.display = radio.value === 'dates' ? 'block' : 'none';
            // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
            if (radio.value === 'days') {
                document.getElementById('startDate').value = '';
                document.getElementById('endDate').value = '';
            } else {
                document.getElementById('vacationDays').value = '';
            }
        });
    });

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById('calcForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        document.getElementById('result').style.display = 'none';
        document.getElementById('error').style.display = 'none';

        const salary = parseFloat(document.getElementById('salary').value);
        if (!salary || salary <= 0) {
            showError('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∑–∞—Ä–ø–ª–∞—Ç—É (–±–æ–ª—å—à–µ 0)');
            return;
        }

        let url = `/calculate?averageSalary=${salary}`;

        if (document.getElementById('modeDays').checked) {
            const days = parseInt(document.getElementById('vacationDays').value);
            if (!days || days < 1) {
                showError('–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π (–º–∏–Ω–∏–º—É–º 1)');
                return;
            }
            url += `&vacationDays=${days}`;
        } else {
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;
            if (!start || !end) {
                showError('–í–≤–µ–¥–∏—Ç–µ –æ–±–µ –¥–∞—Ç—ã');
                return;
            }
            if (start > end) {
                showError('–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è');
                return;
            }
            url += `&startDate=${start}&endDate=${end}`;
        }

        try {
            const response = await fetch(url);
            const data = await response.json();
            
            if (!response.ok) {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
                if (data.errors) {
                    const errorMessages = Object.values(data.errors).join(', ');
                    throw new Error(errorMessages);
                }
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫
                const errorMessage = data.message || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞';
                throw new Error(errorMessage);
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            document.getElementById('payAmount').textContent = 
                Number(data.vacationPay).toLocaleString('ru-RU', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            document.getElementById('payDays').textContent = data.payableDays;
            document.getElementById('details').textContent = data.calculationDetails;
            document.getElementById('result').style.display = 'block';
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
            document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        } catch (err) {
            showError(err.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
        }
    });

    function showError(message) {
        document.getElementById('errorMessage').textContent = message;
        document.getElementById('error').style.display = 'block';
        document.getElementById('error').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –¥–ª—è –ø–æ–ª–µ–π –¥–∞—Ç
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('startDate').setAttribute('min', today);
    document.getElementById('endDate').setAttribute('min', today);
</script>
</body>
</html>
